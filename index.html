<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>SidakGPT OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&display=swap');
        body { background: #131314; color: #e3e3e3; font-family: 'Google Sans', sans-serif; overflow: hidden; }
        .gemini-blue { color: #8ab4f8; }
        .sidebar { background: #1e1f20; width: 280px; transition: 0.3s; position: fixed; height: 100vh; z-index: 100; left: -280px; border-right: 1px solid #333; }
        .sidebar.open { left: 0; }
        .chat-item { padding: 10px; border-radius: 8px; cursor: pointer; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: 0.2s; }
        .chat-item:hover { background: #3c4043; }
        .input-pill { background: #1e1f20; border-radius: 32px; border: 1px solid #3c4043; }
        .ai-row { display: flex; gap: 20px; margin-top: 35px; border-left: 2px solid #333; padding-left: 20px; }
        .s-spark { width: 30px; height: 30px; filter: drop-shadow(0 0 5px #8ab4f8); }
        .user-bubble { background: #2b2d31; border-radius: 24px; padding: 12px 24px; max-width: 80%; margin-left: auto; }
        pre { border-radius: 12px !important; background: #000 !important; border: 1px solid #333; position: relative; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .loader { height: 3px; width: 100%; background: linear-gradient(90deg, #4285f4, #9b72cb, #d96570); background-size: 200% 100%; animation: pulse 1.5s infinite; display: none; }
        @keyframes pulse { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }
    </style>
</head>
<body class="flex" onload="loadHistory()">

    <nav id="sidebar" class="sidebar p-4 flex flex-col">
        <div class="flex items-center justify-between mb-8">
            <span class="font-medium">Recent Chats</span>
            <i data-lucide="x" onclick="toggleSide()" class="cursor-pointer"></i>
        </div>
        <button onclick="newChat()" class="bg-[#2b2d31] hover:bg-zinc-700 p-4 rounded-full flex items-center gap-3 mb-6 transition">
            <i data-lucide="plus"></i> New Chat
        </button>
        <div id="history-list" class="flex-1 overflow-y-auto no-scrollbar space-y-2">
            </div>
    </nav>

    <div class="flex-1 flex flex-col h-screen relative">
        <header class="p-4 flex items-center justify-between sticky top-0 bg-[#131314]/90 backdrop-blur-md z-50">
            <i data-lucide="menu" onclick="toggleSide()" class="cursor-pointer"></i>
            <div class="absolute left-1/2 transform -translate-x-1/2 text-xl font-medium gemini-blue">SidakGPT</div>
            <div class="s-spark"><svg viewBox="0 0 24 24" fill="#8ab4f8"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"/></svg></div>
        </header>

        <main id="flow" class="flex-1 overflow-y-auto px-4 md:px-64 py-10 no-scrollbar">
            <div id="welcome" class="mt-40 text-center">
                <h1 class="text-5xl font-medium bg-gradient-to-r from-blue-400 via-purple-400 to-red-400 bg-clip-text text-transparent pb-4">Hello, Sidak</h1>
                <p class="text-zinc-500 text-xl">Your conversations are safe with SidakGPT.</p>
            </div>
        </main>

        <footer class="p-6 md:px-64 pb-12">
            <div id="loader" class="loader mb-4 rounded-full"></div>
            <div class="input-pill flex items-center px-6 py-1 gap-4">
                <input id="prompt" class="flex-1 bg-transparent py-5 outline-none text-white" placeholder="Message SidakGPT...">
                <button onclick="run()" class="text-blue-400"><i data-lucide="send-horizontal" class="w-7 h-7"></i></button>
            </div>
        </footer>
    </div>

    <script>
        lucide.createIcons();
        const BRAIN = "https://gptbrain.ekamsingh4293.workers.dev";
        let currentChatId = null;

        function toggleSide() { document.getElementById('sidebar').classList.toggle('open'); }

        function newChat() {
            currentChatId = Date.now();
            document.getElementById('flow').innerHTML = '<div id="welcome" class="mt-40 text-center"><h1 class="text-5xl font-medium text-white pb-4">New Chat</h1></div>';
            toggleSide();
        }

        function saveMessage(role, text) {
            if (!currentChatId) currentChatId = Date.now();
            let history = JSON.parse(localStorage.getItem('sidak_history') || '{}');
            if (!history[currentChatId]) history[currentChatId] = { title: text.substring(0, 30), messages: [] };
            history[currentChatId].messages.push({ role, text });
            localStorage.setItem('sidak_history', JSON.stringify(history));
            loadHistory();
        }

        function loadHistory() {
            const list = document.getElementById('history-list');
            const history = JSON.parse(localStorage.getItem('sidak_history') || '{}');
            list.innerHTML = '';
            Object.keys(history).reverse().forEach(id => {
                const item = document.createElement('div');
                item.className = 'chat-item';
                item.innerText = history[id].title;
                item.onclick = () => openChat(id);
                list.appendChild(item);
            });
        }

        function openChat(id) {
            currentChatId = id;
            const history = JSON.parse(localStorage.getItem('sidak_history'));
            const flow = document.getElementById('flow');
            document.getElementById('welcome').style.display = 'none';
            flow.innerHTML = '';
            history[id].messages.forEach(msg => {
                if(msg.role === 'user') {
                    flow.innerHTML += `<div class="flex justify-end my-8"><div class="user-bubble">${msg.text}</div></div>`;
                } else {
                    flow.innerHTML += `<div class="ai-row"><div class="s-spark"><svg viewBox="0 0 24 24" fill="#8ab4f8"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"/></svg></div><div class="flex-1">${marked.parse(msg.text)}</div></div>`;
                }
            });
            toggleSide();
            Prism.highlightAll();
        }

        async function run() {
            const input = document.getElementById('prompt');
            const txt = input.value.trim();
            if(!txt) return;

            document.getElementById('welcome').style.display = 'none';
            document.getElementById('loader').style.display = 'block';
            
            flow.innerHTML += `<div class="flex justify-end my-8"><div class="user-bubble">${txt}</div></div>`;
            saveMessage('user', txt);
            input.value = "";

            try {
                const res = await fetch(BRAIN, { method: 'POST', body: JSON.stringify({ messages: [{content: txt}] }) });
                const data = await res.json();
                document.getElementById('loader').style.display = 'none';
                
                const reply = data.reply;
                flow.innerHTML += `<div class="ai-row"><div class="s-spark"><svg viewBox="0 0 24 24" fill="#8ab4f8"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"/></svg></div><div class="flex-1">${marked.parse(reply)}</div></div>`;
                saveMessage('ai', reply);
                
                Prism.highlightAll();
                flow.scrollTop = flow.scrollHeight;
            } catch(e) { document.getElementById('loader').style.display = 'none'; }
        }
    </script>
</body>
</html>
