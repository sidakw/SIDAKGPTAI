<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIDAK PEXELS ONLY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="bg-black text-white h-screen flex flex-col">

    <header class="p-4 border-b border-zinc-800 font-bold text-center text-blue-500">SIDAKGPT PHOTO SEARCH</header>

    <main id="chat" class="flex-1 overflow-y-auto p-4 space-y-4"></main>

    <footer class="p-4 bg-zinc-900 flex gap-2">
        <input id="prompt" class="flex-1 bg-zinc-800 p-3 rounded-lg outline-none" placeholder="Type a photo topic...">
        <button onclick="run()" class="bg-blue-600 px-6 py-3 rounded-lg font-bold">Search</button>
    </footer>

    <script>
        const BRAIN_URL = "https://gptbrain.ekamsingh4293.workers.dev"; // Your Worker URL
        const chat = document.getElementById('chat');

        function render(role, text, imgHtml = '') {
            const div = document.createElement('div');
            div.className = role === 'user' ? 'text-right' : 'text-left';
            div.innerHTML = `<div class="inline-block p-3 rounded-xl ${role === 'user' ? 'bg-blue-600' : 'bg-zinc-800'} max-w-[90%]">
                ${marked.parse(text)} ${imgHtml}
            </div>`;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        async function run() {
            const input = document.getElementById('prompt');
            const txt = input.value.trim();
            if(!txt) return;

            render('user', txt);
            input.value = "";

            try {
                const res = await fetch(BRAIN_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: [{content: txt}] })
                });
                const data = await res.json();
                const aiMsg = data.reply;
                let photoHtml = "";

                const pexMatch = aiMsg.match(/\[PEXELS:(.*?)\]/i);
                if(pexMatch) {
                    const term = pexMatch[1].trim();
                    const pexRes = await fetch(BRAIN_URL, {
                        method: 'POST',
                        body: JSON.stringify({ type: 'pexels', prompt: term })
                    });
                    const pexData = await pexRes.json();
                    if(pexData.url) {
                        photoHtml = `<img src="${pexData.url}" class="mt-2 rounded-lg border border-zinc-700 w-full">`;
                    }
                }

                render('ai', aiMsg, photoHtml);
            } catch(e) { render('ai', 'Error fetching photo.'); }
        }
    </script>
</body>
</html>
